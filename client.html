<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<div>
    mykey：<textarea id="mykey"></textarea><br>
    remotekey：<textarea id="remotekey"></textarea><br>
</div>
<div><button id="connbtn">connect</button></div>
<div>
    <input type="text" id="msgInput" /><button id="textbtn">send</button>
</div>

sendFile：<input type="file" id="file"  "/><br>


<div id="stage" style="margin: 10px 10px 10px 10px;">
    
</div>
<script src="/socket.io/socket.io.js"></script>
<script>

    // const socket = io();
   var mykey = document.getElementById("mykey");
   var remotekey = document.getElementById("remotekey");
   var connbtn = document.getElementById("connbtn");
   var msgInput = document.getElementById("msgInput");
   var textbtn = document.getElementById("textbtn");
   var file = document.getElementById("file");
   var stage = document.getElementById("stage");

    connbtn.addEventListener("click", function () {
        const socket = io("/", {
            reconnectionDelayMax: 10000,
            auth: {
                token: mykey.value
            }
        });

        socket.on('connect', (socket) => {             var div = document.createElement('div');
            div.innerHTML = "connected"
            stage.appendChild(div)
        });
        socket.on('disconnect', () => {
            var div = document.createElement('div');
            div.innerHTML = "disconnected by server"
            stage.appendChild(div)
        });
        socket.on("text",(data)=>{
            var div = document.createElement('div');
            div.innerHTML = JSON.stringify(data)
            
            stage.appendChild(div)
        })
        socket.on("file", (data) => {

            console.log("file coming");
            const a = document.createElement('a');
   
            a.download = data.filename;
            a.href = "/doc/"+data.id;
            a.text = data.sender+"__to__"+data.receiver+"___"+data.filename
            a.style="magrin: 5 5 5 5"
            console.log("herf ",a.herf);
            document.body.appendChild(a);
   

        })

        textbtn.addEventListener("click", function () {
            console.log(msgInput.value);
            if(msgInput.value){
                socket.emit("text", {sender: mykey.value , receiver: remotekey.value, message: msgInput.value });
                console.log("msg sent");
            }
        });
        
        file.addEventListener("change",function(e){
            console.log("filllllllll");
            console.log(e.target.files[0].name);
            socket.emit("file", {sender: mykey.value , receiver: remotekey.value, "file": e.target.files[0], filename: e.target.files[0].name});
        })

    })



//    function uploadfile  (e){
//         //console.log(e.files[0].size);
//         var file =e.files[0]
//         if(file && ((file.size) / 1000)<1000){
//             const socket = io("/", {
//                 reconnectionDelayMax: 10000,
//                 auth: {
//                     token: "123"
//                 },
//                 query: {
//                     "file": file
//                 }
//             });
//             socket.on('connect', (socket) => {
//                 var textarea = document.getElementById("tarea");
//                 textarea.innerText = "connected";
                
//             });
//             socket.on('disconnect', () => {
//                 document.getElementById("tarea").innerText("dis conn...");
//             });

//             textbtn.addEventListener("click", function () { 
//                 console.log(msgInput.value);
//                 if(msgInput.value){

//                     socket.emit("text", msgInput.value);
//                     console.log("msg sent");
//                 }
//              });

//         }else{
//             textarea.innerText ="..."
//         }
        
//    }
</script>
</body>
</html>